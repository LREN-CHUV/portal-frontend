<div class="dataset-box">
  <div class="dataset-container">
    <div class="panel" style="flex: 0 0 1; max-width: 180px; width: 180px">
      <uib-accordion>
        <div uib-accordion-group is-open="true">
          <uib-accordion-heading>
            <span class="ti ti-check-box"></span>
            Datasets
          </uib-accordion-heading>
          <div class="panel-body variable-list scrollable">
            <div ng-repeat="(dataset, enabled) in uiSelectedDatasets">
              <label>
                <input
                  ng-model="uiSelectedDatasets[dataset]"
                  type="checkbox">
                {{uiSelectedDatasetName(dataset)}}
              </label>
            </div>
          </div>
        </div>
      </uib-accordion>

      <uib-accordion>
        <div uib-accordion-group is-open="true">
          <uib-accordion-heading>
            <span class="ti ti-check-box"></span>
            Model
          </uib-accordion-heading>
          <div class="panel-body variable-list scrollable">

            <h5>
              <a ng-click="configureFilterQuery()">
                <i class="ti ti-panel"></i>
                Filter variable
              </a>
            </h5>
            <p ng-repeat="filter in query.filters track by $index">
              <a ng-click="configureFilterQuery()">
                {{filter.code}}
              </a>
            </p>
            <div class="query" ng-bind="query.textQuery"></div>
            <h5 ng-if="query.variables.length">Variable</h5>
            <p ng-repeat="variable in query.variables">
              {{variable.code}}
            </p>

            <h5 ng-if="query.coVariables.length || query.groupings.length">CoVariables</h5>
            <p ng-repeat="covariable in query.groupings">
                {{covariable.code}}
            </p>
            <p ng-repeat="covariable in query.coVariables">
              <span>
                {{covariable.code}}
              </span>
            </p>
          </div>
        </div>
      </uib-accordion>

    </div>

    <div class="panel" style="flex-grow: 2">
      <uib-tabset active="active">

        <uib-tab index="0" heading="Table">
          <div class="panel-body scrollable">
            <div ng-if="loading " class="loading">
              <div class="fa fa-spin fa-spinner"></div>
            </div>
            <div ng-if="tableError">
              There was an error perfoming the method
              <pretty-json data="tableError"></pretty-json>
            </div>
            <span ng-if="mySavedModels">
              <a class="btn btn-primary" ui-sref="data({scope: 'mydata'})"><span>Go to saved models</span></a>
            </span>
            <div ng-if="tableHeader" style="background-color: #d5e5fd; padding: 0.5em" class="dt-wrapper">
              <div class="export-pannel">
                <div ng-click="toogleExport()" class="export-btn-sandwich" ng-mouseleave="exportClose()" ng-mouseover="exportCloseDeny()">
                  <span></span>
                  <span></span>
                  <span></span>
                  <div ng-if="exportPannel" class="export-menu">
                    <a title="Export Table to CSV" ng-click="csv.generate()" ng-href="{{ csv.link() }}" download="myTable.csv">Export as CSV
                    </a>
                    <a title="Export Table to PNG" ng-click="png.generate()">Export as PNG
                    </a>
                  </div>
                </div>
                <a title="Save PNG" class="btn btn-primary" ng-if="png.ready()" ng-click="png.hideLink()" ng-href="{{ png.link() }}" download="{{ png.name() }}"
                  class="btn btn-default save-btn">
                  Save PNG
                </a>
              </div>
              <table class="table" export-csv="csv" export-to-png="png" separator=";">
                <tr style="background-color: transparent ">
                  <th ng-repeat="column in tableHeader track by $index">
                    <h6 style="text-transform: uppercase ">{{column}}</h6>
                  </th>
                </tr>
                <tr ng-repeat="row in tableRows track by $index" ng-class="{ 'white-row': row.header } ">
                  <td ng-if="row.header" ng-repeat="text in row.data track by $index" class="header-row">{{text}}</td>
                  <td ng-if="!row.header">
                    <strong ng-if="!row.subrow">{{row.variable.label}}</strong>
                    <strong style="margin-left: 10px" ng-if="row.subrow">{{row.variable.label}}</strong>
                  </td>
                  <td ng-if="!row.header" ng-repeat="column in row.data track by $index" class="sub-row" style="text-align: center">
                    <span ng-if="column.status">{{column.status}}</span>
                    <span ng-if="column.mean">
                      <strong>{{column.mean | number: 2}}</strong> ({{column.min | number: 2}}-{{column.max | number: 2}}), std:
                      {{column.std | number: 2}}
                    </span>
                    <span ng-if="!column.mean">
                      <strong>{{column.count}}</strong>
                      <span ng-if="column.null_count">
                        {{"(Null count: " + column.null_count + ")"}}
                      </span>
                    </span>
                  </td>
                </tr>
              </table>
            </div>
          </div>
        </uib-tab>

        <!-- <uib-tab index="1" heading="Histogram" ng-click="getHistogram()" disable="allDatasets === null">
          <div class="panel-body scrollable">
            <div ng-if="loading" class="loading">
              <div class="fa fa-spin fa-spinner"></div>
            </div>
            <div ng-if="histogramData" ng-repeat="data in histogramData">
              <highchart config="data" class="highchart-width highcharts-container"></highchart>
              <hr>
            </div>
            <div ng-if="histogramError">
              There was an error perfoming the method
              <pretty-json data="histogramError"></pretty-json>
            </div>
          </div>
        </uib-tab> -->

        <uib-tab index="2" heading="Boxplot" disable="boxplotError" title="{{boxplotError}}">
          <div class="panel-body scrollable">
            <div ng-if="loading" class="loading">
              <div class="fa fa-spin fa-spinner"></div>
            </div>
            <div ng-if="boxplotError">
              There was an error perfoming the method
              <pretty-json data="boxplotError"></pretty-json>
            </div>
            <highchart ng-if="boxplotData" style="margin-top: 25px" class="highchart-width highcharts-container" ng-repeat="data in boxplotData"
              config="data">
            </highchart>
          </div>
        </uib-tab>

        <uib-tab index="3" ng-if="isLocal" heading="Charts" ng-click="executeQuery()">
          <div class="panel-body scrollable">
            <div class="col-md-8">
              <div class="panel panel-charts">
                <div class="panel-body panel-charts-graph">
                  <div class="panel-body-graph" data-graph-type="column">
                    <highchart ng-if="hcConfig" config="hcConfig"></highchart>
                  </div>
                </div>
                <div class="panel-body panel-data-graph" style="height:480px; overflow-y:scroll;">
                  <table class="table m-n">
                    <thead>
                      <tr>
                        <th>#</th>
                        <th ng-repeat="header in dataset.header | limitTo: maxCol">{{header}}</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr ng-repeat="(indexData,result) in dataset.data[dataset.header[0]] | limitTo: maxRow as limited_result track by indexData ">
                        <td>{{indexData+1}}</td>
                        <td ng-repeat="(indexHeader,header) in dataset.header | limitTo: maxCol">{{dataset.data[header][indexData]}}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            <div ng-include="'scripts/app/models/review/configuration.html'"></div>
          </div>
        </uib-tab>

        <uib-tab index="4" heading="Heatmap" ng-click="getHeatmap()" disable="heatmapError" title="{{heatmapError}}">
          <div class="panel-body scrollable">

            <div ng-if="heatmapLoading" class="loading">
              <div class="fa fa-spin fa-spinner"></div>
            </div>

            <div ng-if="heatmapError">
                There was an error perfoming the method
                <pretty-json data="heatmapError"></pretty-json>
              </div>

            <div ng-if="heatmapData" class="dt-wrapper">
              <plotly-charts chart-data="heatmapData"></plotly-charts>
            </div>

          </div>
        </uib-tab>

      </uib-tabset>
    </div>
  </div>

</div>
